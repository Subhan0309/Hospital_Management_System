<div class="container">
  <h1>Comments for Medical Record</h1>
  <div class="card mb-4">
    <div class="card-body">
      <% @comments.each do |comment| %>
        <div class="comment mb-3">
          <p><strong>Commented by:</strong> <%= comment.created_by.name %> (<%= comment.created_by.role.capitalize %>)</p>
          <p><%= comment.description %></p>
          <p><em><%= comment.created_at.strftime('%B %d, %Y %H:%M') %></em></p>

          <!-- Action buttons for update and delete -->
          <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-warning btn-sm me-2" data-bs-toggle="modal" data-bs-target="#editCommentModal-<%= comment.id %>">
              Edit
            </button>
            <%= button_to 'Delete', user_medical_record_comment_path(@user, @medical_record, comment), method: :delete, data: { confirm: 'Are you sure you want to delete this comment?' }, class: 'btn btn-danger btn-sm' %>
          </div>
        </div>
        <hr>

        <!-- Modal for editing a specific comment -->
        <div class="modal fade" id="editCommentModal-<%= comment.id %>" tabindex="-1" aria-labelledby="editCommentModalLabel-<%= comment.id %>" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editCommentModalLabel-<%= comment.id %>">Edit Comment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <%= form_with(model: [current_user, @medical_record, comment], url: user_medical_record_comment_path(current_user, @medical_record, comment), method: :patch, local: true, html: { id: "edit_comment_form_#{comment.id}" }) do |f| %>
                  <div class="form-group">
                    <%= f.label :description %>
                    <%= f.text_area :description, class: 'form-control', required: true %>
            <div class="invalid-feedback">
              Description can't be empty.
            </div>
                  </div>
                  <div class="form-group mt-3">
                    <%= f.submit 'Update Comment', class: 'btn btn-primary' %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
