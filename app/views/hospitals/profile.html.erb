<div class="container my-5">
  <div class="card shadow-lg">
    <div class="card-header bg-secondary d-flex justify-content-between align-items-center">
      <h5 class="text-light">Hospital Profile</h5>
       <% if current_user.owner? %>
      <div>
        <button id="edit-button" class="btn btn-outline-light"><i class="bi bi-pen mx-1"></i>Update</button>
      </div>
       <% end %>
    </div>

    <div class="card-body">
      <%= form_with(model: @hospital, local: true, id: 'hospital-form', html: { method: :patch, multipart: true }) do |f| %>
        <%= render "devise/shared/error_messages", resource: @hospital %>

        <!-- Logo Upload and Preview -->
        <div class="form-group mb-3 text-center">
          <% if @hospital.logo.attached? %>
            <%= image_tag @hospital.logo, id: 'logo-preview', class: 'img-fluid rounded-circle shadow', size: '150x150' %>
          <% else %>
            <%= image_tag 'default-profile.jpeg', id: 'logo-preview', class: 'img-fluid rounded-circle shadow', size: '150x150' %>
          <% end %>
          <br>
          <%= f.file_field :logo, accept: 'image/*', class: 'form-control mt-3', style: 'display: none;' %>
        </div>

        <div class="mb-3">
          <%= f.label :name, 'Hospital Name *', class: 'fw-bold' %>
          <div class="input-group mt-2">
            <span class="input-group-text"><i class="bi bi-building"></i></span>
            <%= f.text_field :name, class: 'form-control', readonly: true %>
          </div>
        </div>

        <div class="mb-3">
          <%= f.label :location, 'Location *', class: 'fw-bold' %>
          <div class="input-group mt-2">
            <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
            <%= f.text_field :location, class: 'form-control', readonly: true %>
          </div>
        </div>

        <div class="mb-3">
          <%= f.label :email, 'Email *', class: 'fw-bold' %>
          <div class="input-group mt-2">
            <span class="input-group-text"><i class="bi bi-envelope"></i></span>
            <%= f.email_field :email, class: 'form-control', readonly: true %>
          </div>
        </div>

        <div class="mb-3">
          <%= f.label :license_no, 'License Number *', class: 'fw-bold' %>
          <div class="input-group mt-2">
            <span class="input-group-text"><i class="bi bi-file-earmark-text"></i></span>
            <%= f.text_field :license_no, class: 'form-control', readonly: true %>
          </div>
        </div>

        <div class="text-center mt-4">
          <%= f.submit "Save Changes", class: 'btn btn-outline-success', id: 'save-button', style: 'display: none;' %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  document.addEventListener('turbolinks:load', function() {
    const editButton = document.getElementById('edit-button');
    const saveButton = document.getElementById('save-button');
    const formFields = document.querySelectorAll('#hospital-form input[readonly]');
    const logoInput = document.querySelector('input[name="hospital[logo]"]');
    const logoPreview = document.getElementById('logo-preview');

    editButton.addEventListener('click', function() {
      formFields.forEach(field => {
        field.removeAttribute('readonly');
      });
      logoInput.style.display = 'block';
      saveButton.style.display = 'block';
      editButton.style.display = 'none';
    });

    // Preview the uploaded logo
    logoInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          logoPreview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  });
</script>
